# –î–µ–ø–ª–æ–π –Ω–∞ Vast.ai - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø—Ä–∞–≤–∏–ª–∏

**–û—à–∏–±–∫–∞ `CL_OUT_OF_RESOURCES`** –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ OpenCL ProQue –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `.dims(BATCH_SIZE)` —Å –±–æ–ª—å—à–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º (5M), —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ pre-allocation —Ä–µ—Å—É—Ä—Å–æ–≤ GPU.

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –£–±—Ä–∞–Ω `.dims()` –∏–∑ ProQue builder - —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–º–µ—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ kernel
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏ GPU –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ batch size
3. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –∫—Ä–∞—Ö–µ

## –®–∞–≥–∏ –¥–ª—è –¥–µ–ø–ª–æ—è

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–ù–∞ –≤–∞—à–µ–π **–ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ**:
```bash
cd /Users/vivenlmao/Desktop/coding/myprojects/eth_recover_session/eth_recovery

# –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
cargo build --release

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ binary –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–∑–∞–º–µ–Ω–∏—Ç–µ IP –∏ –ø—É—Ç—å)
scp target/release/eth_recovery root@YOUR_VAST_IP:/workspace/eth_recovery/
scp deploy/restart_worker.sh root@YOUR_VAST_IP:/workspace/eth_recovery/
```

### 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Vast.ai

SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
ssh root@YOUR_VAST_IP
cd /workspace/eth_recovery
```

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
```bash
pkill -9 eth_recovery
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –Ω–æ–≤—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º:
```bash
chmod +x restart_worker.sh
./restart_worker.sh
```

### 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ git:
```bash
cd /workspace/eth_recovery
git pull
cargo build --release
./deploy/restart_worker.sh
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
tail -f /workspace/eth_recovery/worker.log
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU:
```bash
watch -n 1 nvidia-smi
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å worker:
```bash
ps aux | grep eth_recovery
```

## –ß—Ç–æ –æ–∂–∏–¥–∞—Ç—å

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ OpenCL —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: NVIDIA GeForce RTX 5090
   Max work group size: 1024
   Global memory: 32109 MB
   Max allocation: 8027 MB

üíæ –†–∞—Å—á–µ—Ç –ø–∞–º—è—Ç–∏:
   –î–æ—Å—Ç—É–ø–Ω–æ GPU –ø–∞–º—è—Ç–∏: 32109 MB
   –ë–î –∑–∞–Ω–∏–º–∞–µ—Ç: 4096 MB
   –°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –±–∞—Ç—á–µ–π: 18380 MB
   –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π batch size: XXXXXXX –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

‚úÖ GPU Worker –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
```

–ò –∑–∞—Ç–µ–º worker –¥–æ–ª–∂–µ–Ω **–Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É** –±–µ–∑ –æ—à–∏–±–æ–∫ `CL_OUT_OF_RESOURCES`.

## Troubleshooting

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `sudo reboot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NVIDIA drivers: `nvidia-smi`
3. –£–º–µ–Ω—å—à–∏—Ç–µ `BATCH_SIZE` –≤ `src/main.rs` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ 1M –∏–ª–∏ 500K)
4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `cargo build --release`
